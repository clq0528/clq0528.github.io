<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ–°èƒ½æºé…ç”µæŸœå›è·¯ä»¿çœŸ - ä¸‰è·¯è¿çº¿ä¿®æ­£ç‰ˆ</title>
    <style>
        :root {
            --bg-color: #0d0e0f;
            --wire-off: #222;
            --wire-pwr: #ff8c00;  /* å¼ºç”µåŠ¨åŠ›ï¼šæ©™è‰² */
            --wire-ctrl: #00d9ff; /* å¼±ç”µæ§åˆ¶ï¼šè“è‰² */
            --led-on: #00ff00;
        }

        body { margin: 0; padding: 0; background: var(--bg-color); color: white; font-family: "Microsoft YaHei", sans-serif; display: flex; height: 100vh; overflow: hidden; }

        /* --- æ—¥å¿—åŒº --- */
        #log-panel { width: 300px; background: #000; border-right: 2px solid #333; display: flex; flex-direction: column; padding: 10px; z-index: 100; }
        #log-list { flex: 1; overflow-y: auto; font-size: 11px; color: #00ff00; font-family: monospace; border: 1px solid #222; }
        .log-line { border-bottom: 1px solid #111; padding: 3px; }

        /* --- ä¸»è§†å›¾ --- */
        #viewport { flex: 1; overflow-y: auto; position: relative; background: #111; scroll-behavior: smooth; }
        #simulation-container { width: 900px; margin: 0 auto; padding: 20px 0; }

        /* æ’æ˜¾ç¤ºè§£è¯´ */
        #god-view-msg {
            position: sticky; top: 10px; left: 50%; width: 90%; background: rgba(0, 40, 80, 0.95);
            border: 2px solid #00d9ff; padding: 15px; border-radius: 8px; z-index: 200;
            box-shadow: 0 0 20px rgba(0, 217, 255, 0.3); margin: 0 auto 20px;
        }

        /* æŸœä½“å®ä½“ */
        #cabinet {
            width: 820px; height: 950px; background: #222; margin: 0 auto;
            border: 5px solid #444; border-radius: 10px; position: relative;
            box-shadow: 0 0 50px #000;
        }

        /* SVG ç²¾å‡†çº¿è·¯ï¼šæ¨ªå¹³ç«–ç›´èµ°çº¿æ§½æ¨¡å¼ */
        #svg-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
        .wire { fill: none; stroke: var(--wire-off); stroke-width: 3; transition: 0.3s; stroke-linecap: square; }
        .w-active-pwr { stroke: var(--wire-pwr); filter: drop-shadow(0 0 5px var(--wire-pwr)); stroke-dasharray: 12, 6; animation: flow 1s linear infinite; stroke-width: 4; }
        .w-active-ctrl { stroke: var(--wire-ctrl); filter: drop-shadow(0 0 3px var(--wire-ctrl)); stroke-dasharray: 8, 4; animation: flow 1s linear infinite; stroke-width: 3; }
        @keyframes flow { to { stroke-dashoffset: -18; } }

        /* å…ƒä»¶æ ·å¼ */
        .comp {
            position: absolute; width: 65px; height: 90px; background: #e0e0e0;
            border: 1px solid #999; border-radius: 3px; z-index: 10;
            display: flex; flex-direction: column; align-items: center; color: #000;
            padding: 5px 0; box-shadow: 2px 2px 8px rgba(0,0,0,0.5); cursor: pointer;
        }
        .comp.active { background: #fff; border: 2px solid var(--led-on); box-shadow: 0 0 15px rgba(0,255,0,0.5); }
        .comp.fault { background: #ffaaaa; border: 2px solid red; animation: blink 0.3s infinite; }
        @keyframes blink { 50% { opacity: 0.6; } }

        .led { width: 10px; height: 10px; border-radius: 50%; background: #444; border: 1px solid #000; margin-bottom: 4px; }
        .led.on { background: var(--led-on); box-shadow: 0 0 10px var(--led-on); }
        .comp-id { font-size: 14px; font-weight: bold; color: #0056b3; margin-top: auto; }
        .comp-name { font-size: 9px; font-weight: bold; text-align: center; line-height: 1.1; }

        /* å…ƒä»¶ç‰¹è‰² */
        .fu { width: 35px; border-radius: 15px; background: #fff; }
        .relay { background: #e3f2fd; } 
        .fr { background: #333; color: white; border-color: #000; }

        /* åŸç†å›¾ */
        #theory-zone {
            width: 820px; height: 300px; background: #1a1a1a; margin: 30px auto;
            border: 2px dashed #444; border-radius: 10px; padding: 20px; box-sizing: border-box;
        }
        .theory-flex { display: flex; justify-content: space-around; align-items: center; }
        .contact-box { text-align: center; color: #aaa; width: 250px; }
        .logic-sym { font-size: 50px; height: 60px; color: #444; transition: 0.3s; }
        .logic-sym.on { color: #00d9ff; }

        /* è´Ÿè½½ */
        #load-zone { width: 820px; height: 150px; margin: 20px auto; display: flex; justify-content: space-around; align-items: center; }
        .motor-box { text-align: center; color: #777; width: 150px; }
        .motor-icon { width: 50px; height: 50px; border: 4px solid #444; border-radius: 50%; margin: 10px auto; position: relative; }
        .motor-icon::after { content: ''; position: absolute; top: 23px; left: 0; width: 100%; height: 4px; background: #555; }
        .run { animation: spin 0.2s linear infinite; border-color: var(--led-on); }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* å³ä¾§é¢æ¿ */
        #ctrl-panel { width: 280px; background: #1c1e20; border-left: 2px solid #333; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .btn-group { border: 1px solid #444; padding: 8px; border-radius: 5px; background: #252525; }
        button { width: 100%; padding: 10px; margin: 4px 0; border: none; border-radius: 4px; cursor: pointer; color: white; font-weight: bold; transition: 0.1s; }
        button:active { transform: scale(0.96); }
        .btn-on { background: #27ae60; }
        .btn-off { background: #c0392b; }
        .btn-estop { background: #f1c40f; color: #000; height: 50px; font-size: 16px; font-weight: 900; border: 3px solid #000; margin-top: 10px; }
    </style>
</head>
<body>

<div id="log-panel">
    <div style="font-weight: bold; color: #888; border-bottom: 1px solid #333; padding-bottom: 8px; margin-bottom: 10px;">ç”µæ°”æŸœè¿è¡Œæ—¥å¿—</div>
    <div id="log-list"></div>
</div>

<div id="viewport">
    <div id="simulation-container">
        
        <div id="god-view-msg">
            <h3 style="margin:0 0 8px 0; color:#00d9ff">ä¸Šå¸è§†è§’ï¼šä¸ºä»€ä¹ˆç‚¹å‡» B/C ä¹Ÿä¼šæœ‰æ©™è‰²çº¿ï¼Ÿ</h3>
            <p style="margin:0; font-size:13px; line-height:1.4">
                å½“<strong>ä¸­é—´ç»§ç”µå™¨(R)</strong>å¾—ç”µï¼Œè§¦ç‚¹é—­åˆï¼Œå…è®¸ 220V ç”µæµæµå‘<strong>æ¥è§¦å™¨(K)</strong>çº¿åœˆã€‚ä¸€æ—¦ K å¸åˆï¼Œæ©™è‰²åŠ¨åŠ›çº¿å°±ä¼šè´¯é€šï¼š<br>
                <strong>ç”µç½‘ â†’ æ–­è·¯å™¨ â†’ ç†”æ–­å™¨ â†’ æ¥è§¦å™¨è§¦ç‚¹ â†’ çƒ­ç»§ç”µå™¨ â†’ ç”µæœº</strong>ã€‚ æ¯ä¸€è·¯éƒ½æœ‰ç‹¬ç«‹çš„ç‰©ç†çº¿è·¯ã€‚
            </p>
        </div>

        <div id="cabinet">
            <svg id="svg-layer">
                <!-- è¿›çº¿æ€»çº¿ -->
                <path id="w-main" class="wire" d="M 410 0 V 30 H 132 V 50" />
                
                <!-- å›è·¯ A å®Œæ•´è·¯å¾„ -->
                <path id="wire-a" class="wire" d="M 132 140 V 170 M 132 260 V 290 M 132 380 V 410 M 132 500 V 530 M 132 620 V 650 M 132 740 V 770 M 132 860 V 950" />
                
                <!-- å›è·¯ B å®Œæ•´è·¯å¾„ (ä¿®æ­£ï¼šä¹‹å‰ç¼ºå¤±) -->
                <path id="wire-b" class="wire" d="M 362 140 V 170 M 362 260 V 290 M 362 380 V 410 M 362 500 V 530 M 362 620 V 650 M 362 740 V 770 M 362 860 V 950" />
                
                <!-- å›è·¯ C å®Œæ•´è·¯å¾„ (ä¿®æ­£ï¼šä¹‹å‰ç¼ºå¤±) -->
                <path id="wire-c" class="wire" d="M 592 140 V 170 M 592 260 V 290 M 592 380 V 410 M 592 500 V 530 M 592 620 V 650 M 592 740 V 770 M 592 860 V 950" />
                
                <!-- æ§åˆ¶æ¯çº¿ (24V DC) -->
                <path id="w-ctrl" class="wire" d="M 722 140 V 200 H 790 V 455 H 180" />
            </svg>

            <!-- ç¬¬ä¸€æ’ï¼šç”µæº -->
            <div class="comp" id="C-Q1" style="left:100px; top:50px;" onclick="opMaster()">
                <div class="led" id="led-Q1"></div><div class="comp-name">æ€»æ–­è·¯å™¨</div><div class="comp-id">Q1</div>
            </div>
            <div class="comp" id="C-RCD" style="left:330px; top:50px;">
                <div class="led" id="led-RCD"></div><div class="comp-name">æ¼ç”µä¿æŠ¤</div><div class="comp-id">RCD</div>
            </div>
            <div class="comp" id="C-PSU" style="left:690px; top:50px;">
                <div class="led" id="led-PSU"></div><div class="comp-name">24Vç”µæº</div><div class="comp-id">PSU</div>
            </div>

            <!-- ç¬¬äºŒæ’ï¼šæ”¯è·¯ç©ºå¼€ -->
            <div class="comp" id="C-QF1" style="left:100px; top:170px;"><div class="comp-name">æ”¯è·¯ç©ºå¼€</div><div class="comp-id">QF1</div></div>
            <div class="comp" id="C-QF2" style="left:330px; top:170px;"><div class="comp-name">æ”¯è·¯ç©ºå¼€</div><div class="comp-id">QF2</div></div>
            <div class="comp" id="C-QF3" style="left:560px; top:170px;"><div class="comp-name">æ”¯è·¯ç©ºå¼€</div><div class="comp-id">QF3</div></div>

            <!-- ç¬¬ä¸‰æ’ï¼šç†”æ–­å™¨ -->
            <div class="comp fu" id="C-FU1" style="left:115px; top:290px;"><div class="comp-name">ç†”æ–­å™¨</div><div class="comp-id">FU1</div></div>
            <div class="comp fu" id="C-FU2" style="left:345px; top:290px;"><div class="comp-name">ç†”æ–­å™¨</div><div class="comp-id">FU2</div></div>
            <div class="comp fu" id="C-FU3" style="left:575px; top:290px;"><div class="comp-name">ç†”æ–­å™¨</div><div class="comp-id">FU3</div></div>

            <!-- ç¬¬å››æ’ï¼šä¸­é—´ç»§ç”µå™¨ -->
            <div class="comp relay" id="C-R1" style="left:100px; top:410px;">
                <div class="led" id="led-R1"></div><div class="comp-name">ä¸­é—´ç»§ç”µå™¨</div><div class="comp-id">R1</div>
            </div>
            <div class="comp relay" id="C-R2" style="left:330px; top:410px;">
                <div class="led" id="led-R2"></div><div class="comp-name">ä¸­é—´ç»§ç”µå™¨</div><div class="comp-id">R2</div>
            </div>
            <div class="comp relay" id="C-R3" style="left:560px; top:410px;">
                <div class="led" id="led-R3"></div><div class="comp-name">ä¸­é—´ç»§ç”µå™¨</div><div class="comp-id">R3</div>
            </div>

            <!-- ç¬¬äº”æ’ï¼šæ¥è§¦å™¨ -->
            <div class="comp" id="C-K1" style="left:100px; top:530px;">
                <div class="led" id="led-K1"></div><div class="comp-name">äº¤æµæ¥è§¦å™¨</div><div class="comp-id">K1</div>
            </div>
            <div class="comp" id="C-K2" style="left:330px; top:530px;">
                <div class="led" id="led-K2"></div><div class="comp-name">äº¤æµæ¥è§¦å™¨</div><div class="comp-id">K2</div>
            </div>
            <div class="comp" id="C-K3" style="left:560px; top:530px;">
                <div class="led" id="led-K3"></div><div class="comp-name">äº¤æµæ¥è§¦å™¨</div><div class="comp-id">K3</div>
            </div>

            <!-- ç¬¬å…­æ’ï¼šçƒ­ç»§ç”µå™¨ -->
            <div class="comp fr" id="C-FR1" style="left:100px; top:650px;"><div class="comp-name">çƒ­ç»§ç”µå™¨</div><div class="comp-id">FR1</div></div>
            <div class="comp fr" id="C-FR2" style="left:330px; top:650px;"><div class="comp-name">çƒ­ç»§ç”µå™¨</div><div class="comp-id">FR2</div></div>
            <div class="comp fr" id="C-FR3" style="left:560px; top:650px;"><div class="comp-name">çƒ­ç»§ç”µå™¨</div><div class="comp-id">FR3</div></div>
        </div>

        <!-- æ•™å­¦æ¼”ç¤ºåŒº -->
        <div id="theory-zone">
            <h4 style="margin:0 0 15px 0; color:#00d9ff">å¸¸å¼€(NO) / å¸¸é—­(NC) è§¦ç‚¹ä»¿çœŸ (ä»¥å½“å‰æ“ä½œå›è·¯ä¸ºä¾‹)</h4>
            <div class="theory-flex">
                <div class="contact-box">
                    <div id="sym-no" class="logic-sym">â”›</div>
                    <div style="font-size:12px">å¸¸å¼€(NO)è§¦ç‚¹<br><span id="txt-no">æ–­å¼€çŠ¶æ€</span></div>
                </div>
                <div class="contact-box">
                    <div id="sym-nc" class="logic-sym on">â”“</div>
                    <div style="font-size:12px">å¸¸é—­(NC)è§¦ç‚¹<br><span id="txt-nc">é—­åˆçŠ¶æ€</span></div>
                </div>
            </div>
            <div style="margin-top:20px; padding:10px; background:rgba(255,140,0,0.1); border-left:4px solid var(--wire-pwr); font-size:13px;">
                æç¤ºï¼šä¸­é—´ç»§ç”µå™¨çš„ NO è§¦ç‚¹æ§åˆ¶æ¥è§¦å™¨çš„çº¿åœˆã€‚å½“ NO é—­åˆæ—¶ï¼Œå¯¹åº”å›è·¯çš„æ©™è‰²åŠ¨åŠ›çº¿æ‰ä¼šæ¿€æ´»ã€‚
            </div>
        </div>

        <div id="load-zone">
            <div class="motor-box"><div class="motor-icon" id="m1"></div>è´Ÿè½½ç”µæœº A</div>
            <div class="motor-box"><div class="motor-icon" id="m2"></div>è´Ÿè½½ç”µæœº B</div>
            <div class="motor-box"><div class="motor-icon" id="m3"></div>è´Ÿè½½ç”µæœº C</div>
        </div>
    </div>
</div>

<div id="ctrl-panel">
    <div style="text-align:center; font-weight:bold; color:#888; font-size:12px;">æ“ä½œç»ˆç«¯</div>
    <div class="btn-group">
        <div style="font-size:10px; color:#555">å›è·¯ A (å¾ªç¯ç³»ç»Ÿ)</div>
        <button class="btn-on" onclick="ctrl('A', true)">å¯åŠ¨</button><button class="btn-off" onclick="ctrl('A', false)">åœæ­¢</button>
    </div>
    <div class="btn-group">
        <div style="font-size:10px; color:#555">å›è·¯ B (æ’é£ç³»ç»Ÿ)</div>
        <button class="btn-on" onclick="ctrl('B', true)">å¯åŠ¨</button><button class="btn-off" onclick="ctrl('B', false)">åœæ­¢</button>
    </div>
    <div class="btn-group">
        <div style="font-size:10px; color:#555">å›è·¯ C (å‹æœºç³»ç»Ÿ)</div>
        <button class="btn-on" onclick="ctrl('C', true)">å¯åŠ¨</button><button class="btn-off" onclick="ctrl('C', false)">åœæ­¢</button>
    </div>
    <button class="btn-blue" style="background:#2980b9" onclick="fault('FR')">ğŸ”¥ æ¨¡æ‹Ÿçƒ­è¿‡è½½åŠ¨ä½œ</button>
    <button class="btn-estop" onclick="fault('STOP')">EMERGENCY STOP</button>
</div>

<script>
    const sys = { Q1: true, RCD: true, A: false, B: false, C: false, fr_trip: false };

    function log(msg, warn = false) {
        const list = document.getElementById('log-list');
        const time = new Date().toTimeString().split(' ')[0];
        list.innerHTML = `<div class="log-line" style="color:${warn?'#ff4400':'#00ff00'}">[${time}] ${msg}</div>` + list.innerHTML;
    }

    function opMaster() {
        sys.Q1 = !sys.Q1;
        log(`ä¸»é—¸ Q1 æ“ä½œï¼š${sys.Q1?'é—­åˆ':'åˆ†æ–­'}`);
        update();
    }

    function ctrl(id, val) {
        if (!sys.Q1 || !sys.RCD) return log("è­¦å‘Šï¼šåœç”µçŠ¶æ€ï¼Œæ— æ³•å¯åŠ¨ç»§ç”µå™¨ï¼", true);
        if (sys.fr_trip && id === 'A') return log("æ•…éšœï¼šFR1 å·²è„±æ‰£ï¼Œè¯·å…ˆå¤ä½ï¼", true);
        sys[id] = val;
        log(`å›è·¯ ${id}ï¼šæ“ä½œæŒ‰é’®${val?'[å¯åŠ¨]':'[åœæ­¢]'}`);
        update();
    }

    function update() {
        const live = sys.Q1 && sys.RCD;
        
        // å…ƒä»¶æŒ‡ç¤ºç¯
        set('Q1', sys.Q1); set('RCD', live); set('PSU', live);
        set('QF1', live); set('QF2', live); set('QF3', live);

        // å„å›è·¯ç‰©ç†è¿è¡ŒçŠ¶æ€
        const runA = live && sys.A && !sys.fr_trip;
        const runB = live && sys.B;
        const runC = live && sys.C;

        // å¯¹åº”ä¸­é—´ç»§ç”µå™¨ (R)
        set('R1', live && sys.A);
        set('R2', live && sys.B);
        set('R3', live && sys.C);

        // å¯¹åº”æ¥è§¦å™¨ (K)
        set('K1', runA);
        set('K2', runB);
        set('K3', runC);

        // çº¿è·¯åŠ¨ç”» (æ ¸å¿ƒä¿®æ­£ç‚¹ï¼šä¸‰è·¯åŠ¨åŠ›çº¿ç‹¬ç«‹æ§åˆ¶)
        wire('w-main', sys.Q1, 'pwr');
        wire('wire-a', runA, 'pwr');
        wire('wire-b', runB, 'pwr');
        wire('wire-c', runC, 'pwr');
        wire('w-ctrl', live, 'ctrl');

        // è´Ÿè½½åé¦ˆ
        document.getElementById('m1').className = runA ? 'motor-icon run' : 'motor-icon';
        document.getElementById('m2').className = runB ? 'motor-icon run' : 'motor-icon';
        document.getElementById('m3').className = runC ? 'motor-icon run' : 'motor-icon';

        // æ•™å­¦åŒºè§¦ç‚¹é€»è¾‘ (ä»¥å½“å‰æ´»åŠ¨å›è·¯ä¸ºä¾‹)
        const active = sys.A || sys.B || sys.C;
        const symNo = document.getElementById('sym-no');
        const symNc = document.getElementById('sym-nc');
        if (active) {
            symNo.innerHTML = "â”â”"; symNo.classList.add('on');
            symNc.innerHTML = "â”›"; symNc.classList.remove('on');
            document.getElementById('txt-no').innerText = "å·²å¸åˆ (æ¥é€š)";
            document.getElementById('txt-nc').innerText = "å·²æ–­å¼€";
        } else {
            symNo.innerHTML = "â”›"; symNo.classList.remove('on');
            symNc.innerHTML = "â”“"; symNc.classList.add('on');
            document.getElementById('txt-no').innerText = "å¸¸æ€æ–­å¼€";
            document.getElementById('txt-nc').innerText = "å¸¸æ€é—­åˆ (é€š)";
        }

        // æ•…éšœæ˜¾ç¤º
        sys.fr_trip ? document.getElementById('C-FR1').classList.add('fault') : document.getElementById('C-FR1').classList.remove('fault');
    }

    function set(id, on) {
        const c = document.getElementById('C-'+id);
        const l = document.getElementById('led-'+id);
        if(c) on ? c.classList.add('active') : c.classList.remove('active');
        if(l) on ? l.classList.add('on') : l.classList.remove('on');
    }

    function wire(id, on, type) {
        const w = document.getElementById(id);
        const cls = type === 'pwr' ? 'w-active-pwr' : 'w-active-ctrl';
        on ? w.classList.add(cls) : w.classList.remove(cls);
    }

    function fault(type) {
        if (type === 'FR') { sys.fr_trip = true; sys.A = false; log("ğŸ”¥ æŠ¥è­¦ï¼šFR1 çƒ­è¿‡è½½è·³è„±ï¼", true); }
        else if (type === 'STOP') { sys.Q1 = false; sys.A = sys.B = sys.C = false; log("ğŸ›‘ æ€¥åœè¢«æŒ‰ä¸‹ï¼", true); }
        update();
        setTimeout(() => {
            if(confirm("å®‰å…¨ç³»ç»Ÿï¼šæ‰§è¡Œäººå·¥å¤ä½ï¼Ÿ")) {
                sys.Q1 = true; sys.RCD = true; sys.fr_trip = false;
                log("ç³»ç»Ÿå¤ä½æˆåŠŸã€‚"); update();
            }
        }, 300);
    }

    update();
</script>
</body>
</html>