<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‰è±PLC äº’é”ç”µè·¯æ·±åº¦ä»¿çœŸ</title>
    <style>
        :root {
            --bg-color: #f4f6f9;
            --panel-bg: #ffffff;
            --plc-color: #2b2b2b;
            --wire-off: #99aab5;
            --wire-on: #e74c3c; /* é€šç”µçº¢ */
            --logic-on: #2ecc71; /* é€»è¾‘ç»¿ */
            --highlight: #f1c40f;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            user-select: none;
        }

        h1 { margin-bottom: 10px; color: #333; }

        /* å¸ƒå±€å®¹å™¨ */
        .main-stage {
            display: grid;
            grid-template-columns: 450px 550px; /* å·¦å®ç‰©ï¼Œå³æ¢¯å½¢å›¾ */
            gap: 20px;
            margin-bottom: 20px;
        }

        /* é€šç”¨é¢æ¿æ ·å¼ */
        .panel {
            background: var(--panel-bg);
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
            border: 1px solid #e0e0e0;
        }
        .panel-title {
            background: #eee;
            padding: 8px 15px;
            font-weight: bold;
            color: #555;
            border-bottom: 1px solid #ddd;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
        }

        /* --- å·¦ä¾§ï¼šå®ç‰©æ¥çº¿ --- */
        #phy-container { height: 500px; position: relative; }

        /* PLC æœ¬ä½“ */
        .plc-unit {
            position: absolute; top: 40px; left: 120px;
            width: 200px; height: 140px;
            background: var(--plc-color);
            border-radius: 4px;
            box-shadow: 4px 4px 10px rgba(0,0,0,0.3);
            color: #fff;
            z-index: 10;
        }
        .plc-label { font-size: 12px; padding: 10px; border-bottom: 1px solid #555; font-weight: bold; }
        .plc-io-row { display: flex; justify-content: space-between; padding: 10px 15px; align-items: center; }
        .io-label { font-size: 10px; color: #aaa; }
        .led-group { display: flex; gap: 8px; }
        .led {
            width: 12px; height: 12px; background: #555; border-radius: 50%;
            border: 1px solid #000; position: relative;
        }
        .led.active { background: #ff3333; box-shadow: 0 0 8px #ff3333; } /* è¾“å…¥LEDé€šå¸¸æ˜¯çº¢è‰² */
        .led.active-out { background: #2ecc71; box-shadow: 0 0 8px #2ecc71; } /* è¾“å‡ºLED */
        .led span { position: absolute; top: -14px; left: 2px; font-size: 9px; color: #ccc; }

        /* å¤–éƒ¨å…ƒä»¶ */
        .btn-group {
            position: absolute; bottom: 40px; left: 30px;
            display: flex; gap: 20px; z-index: 20;
        }
        .btn-wrapper { text-align: center; position: relative; }
        .push-btn {
            width: 50px; height: 50px; border-radius: 50%;
            border: 4px solid #555; cursor: pointer;
            box-shadow: 0 4px 0 #333;
            transition: all 0.1s;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            position: relative;
            z-index: 2;
        }
        .push-btn:active, .push-btn.pressed {
            transform: translateY(4px); box-shadow: 0 0 0 #333;
        }
        .btn-green { background: #27ae60; }
        .btn-red { background: #c0392b; }
        .btn-label { margin-top: 5px; font-size: 12px; color: #333; font-weight: bold; }

        /* æ¥è§¦å™¨ä¸ç”µæœº */
        .km-group {
            position: absolute; top: 250px; right: 30px;
            display: flex; flex-direction: column; gap: 20px; z-index: 20;
        }
        .km-box {
            width: 50px; height: 60px; background: #95a5a6;
            border: 2px solid #7f8c8d; border-radius: 4px;
            display: flex; justify-content: center; align-items: center;
            font-size: 12px; color: white; font-weight: bold;
            position: relative;
            transition: background 0.3s;
        }
        .km-box.active { background: var(--wire-on); box-shadow: 0 0 15px var(--wire-on); border-color: #c0392b; }
        
        .motor-unit {
            position: absolute; bottom: 40px; right: 50px;
            width: 100px; height: 100px;
            background: #34495e; border-radius: 8px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border: 4px solid #2c3e50;
        }
        .motor-shaft {
            width: 60px; height: 60px;
            border-radius: 50%;
            border: 4px dashed #bdc3c7;
            background: #7f8c8d;
            transition: transform 0.1s linear; /* è¿ç»­æ—‹è½¬é JSæ§åˆ¶ */
        }
        .motor-tag { margin-top: 5px; color: #fff; font-size: 10px; }

        /* SVG è¿çº¿å±‚ */
        .wires-svg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 5;
        }
        path {
            fill: none; stroke: var(--wire-off); stroke-width: 3;
            stroke-linecap: round; stroke-linejoin: round;
            transition: stroke 0.3s;
        }
        path.hot { stroke: var(--wire-on); stroke-width: 4; filter: drop-shadow(0 0 3px var(--wire-on)); }

        /* è™šæ‹Ÿæ‰‹æŒ‡ */
        .finger {
            position: absolute; font-size: 40px; z-index: 100;
            pointer-events: none; opacity: 0;
            transform-origin: top left;
            transition: transform 0.1s;
        }
        .finger.tap { animation: tapAnim 0.3s forwards; }
        @keyframes tapAnim {
            0% { opacity: 1; transform: scale(1.2) rotate(-10deg); }
            50% { transform: scale(0.9) rotate(-10deg) translateY(5px); }
            100% { opacity: 0; transform: scale(1) rotate(-10deg); }
        }

        /* --- å³ä¾§ï¼šæ¢¯å½¢å›¾ --- */
        .ladder-canvas {
            padding: 20px;
            font-family: 'Consolas', monospace;
            background: #fff;
            position: relative;
        }
        .rung {
            display: flex; align-items: center; height: 80px;
            border-bottom: 1px dashed #eee; position: relative;
        }
        /* æ¯çº¿ */
        .rail-left { position: absolute; left: 10px; top: 0; bottom: 0; width: 4px; background: #000; }
        .rail-right { position: absolute; right: 10px; top: 0; bottom: 0; width: 4px; background: #000; }

        /* æ¢¯å½¢å›¾å…ƒä»¶ */
        .symbol {
            width: 70px; display: flex; flex-direction: column; align-items: center;
            cursor: help; margin: 0 5px; position: relative;
        }
        .sym-graphic { font-size: 24px; font-weight: bold; color: #333; position: relative; height: 30px; line-height: 30px;}
        .sym-name { font-size: 12px; color: #00f; }
        .sym-addr { font-size: 10px; color: #666; position: absolute; top: -10px; }
        
        /* è¿çº¿ */
        .h-wire { height: 2px; background: #333; flex-grow: 1; position: relative; }
        
        /* çŠ¶æ€é«˜äº® */
        .active-logic .sym-graphic { color: var(--logic-on); text-shadow: 0 0 2px var(--logic-on); }
        .active-logic.h-wire { background: var(--logic-on); box-shadow: 0 0 2px var(--logic-on); height: 3px; }
        
        /* äº’é”é«˜äº®æ¡† */
        .interlock-highlight {
            border: 2px dotted red; border-radius: 4px; padding: 2px;
            animation: pulseBorder 2s infinite;
        }
        @keyframes pulseBorder { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }

        /* æ‰«æçº¿ */
        .scan-line {
            position: absolute; left: 0; right: 0; height: 4px;
            background: rgba(255, 165, 0, 0.4);
            z-index: 50; pointer-events: none; display: none;
        }

        /* --- åº•éƒ¨ï¼šæ–‡æœ¬æŒ‡å¼•ä¸æ§åˆ¶ --- */
        .guide-container {
            width: 1020px;
            display: grid; grid-template-columns: 2fr 1fr; gap: 20px;
        }
        .text-content {
            background: #fff; padding: 20px; border-radius: 8px; font-size: 14px; line-height: 1.6; color: #444;
            max-height: 300px; overflow-y: auto; border: 1px solid #ddd;
        }
        .text-content h3 { margin-top: 0; color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 5px; }
        .step-highlight { background: #fff3cd; padding: 2px 5px; border-radius: 4px; }
        
        .controls {
            background: #fff; padding: 20px; border-radius: 8px; border: 1px solid #ddd;
            display: flex; flex-direction: column; gap: 15px;
        }
        
        /* äº’é”è¯´æ˜Tip */
        .tip-box {
            margin-top: 10px;
            background: #e8f4fd; border-left: 4px solid #3498db; padding: 10px;
            font-size: 12px; color: #333;
        }

    </style>
</head>
<body>

    <h1>ä¸‰è±PLC äº’é”ç”µè·¯ä»¿çœŸ (Forward/Reverse Interlock)</h1>

    <div class="main-stage">
        <!-- å·¦ä¾§ï¼šå®ç‰©æ¥çº¿åŒº -->
        <div class="panel" id="phy-container">
            <div class="panel-title">å®ç‰©æ¥çº¿å›¾ (Physical Wiring)</div>
            
            <!-- è™šæ‹Ÿæ‰‹æŒ‡ -->
            <div class="finger" id="virtual-finger">ğŸ‘†</div>

            <!-- SVG è¿çº¿ (ç»å¯¹å®šä½åæ ‡) -->
            <svg class="wires-svg">
                <!-- X0 (ç»¿è‰²æŒ‰é’®) åˆ° PLC X0 -->
                <path id="w-x0" d="M 65 420 V 350 H 130 V 135" /> 
                <!-- X1 (ç»¿è‰²æŒ‰é’®) åˆ° PLC X1 -->
                <path id="w-x1" d="M 135 420 V 360 H 160 V 135" />
                <!-- X2 (çº¢è‰²æŒ‰é’®) åˆ° PLC X2 -->
                <path id="w-x2" d="M 205 420 V 370 H 190 V 135" />
                
                <!-- PLC Y0 åˆ° KM1 -->
                <path id="w-y0" d="M 160 225 V 280 H 375 V 280" />
                <!-- PLC Y1 åˆ° KM2 -->
                <path id="w-y1" d="M 190 225 V 265 H 375 V 340" />
            </svg>

            <!-- PLC -->
            <div class="plc-unit">
                <div class="plc-label">MITSUBISHI FX3U</div>
                <div class="plc-io-row">
                    <span class="io-label">INPUT (X)</span>
                    <div class="led-group">
                        <div class="led" id="led-x0"><span>0</span></div>
                        <div class="led" id="led-x1"><span>1</span></div>
                        <div class="led" id="led-x2"><span>2</span></div>
                    </div>
                </div>
                <div class="plc-io-row" style="margin-top: 30px;">
                    <span class="io-label">OUTPUT (Y)</span>
                    <div class="led-group">
                        <div class="led" id="led-y0"><span>0</span></div>
                        <div class="led" id="led-y1"><span>1</span></div>
                        <div class="led" id="led-y2"><span>2</span></div>
                    </div>
                </div>
            </div>

            <!-- æŒ‰é’® -->
            <div class="btn-group">
                <div class="btn-wrapper">
                    <div class="push-btn btn-green" id="btn-x0" onmousedown="interact('x0')" onmouseup="release('x0')">X0</div>
                    <div class="btn-label">æ­£è½¬å¯åŠ¨</div>
                </div>
                <div class="btn-wrapper">
                    <div class="push-btn btn-green" id="btn-x1" onmousedown="interact('x1')" onmouseup="release('x1')">X1</div>
                    <div class="btn-label">åè½¬å¯åŠ¨</div>
                </div>
                <div class="btn-wrapper">
                    <div class="push-btn btn-red" id="btn-x2" onmousedown="interact('x2')" onmouseup="release('x2')">X2</div>
                    <div class="btn-label">åœæ­¢</div>
                </div>
            </div>

            <!-- æ¥è§¦å™¨ -->
            <div class="km-group">
                <div class="km-box" id="km1">KM1<br>(Y0)</div>
                <div class="km-box" id="km2">KM2<br>(Y1)</div>
            </div>

            <!-- ç”µæœº -->
            <div class="motor-unit">
                <div class="motor-shaft" id="motor-shaft"></div>
                <div class="motor-tag" id="motor-status">STOP</div>
            </div>
        </div>

        <!-- å³ä¾§ï¼šæ¢¯å½¢å›¾åŒº -->
        <div class="panel">
            <div class="panel-title">
                æ¢¯å½¢å›¾é€»è¾‘ (Ladder Logic)
                <span style="font-size:12px; font-weight:normal;">æ‰«æå‘¨æœŸä»¿çœŸä¸­...</span>
            </div>
            
            <div class="ladder-canvas" id="ladder-canvas">
                <div class="rail-left"></div><div class="rail-right"></div>
                <div class="scan-line" id="scan-line"></div>

                <!-- Rung 1: æ­£è½¬ Y0 -->
                <div class="rung">
                    <div class="h-wire" id="wire-r1-1"></div>
                    <!-- X0 -->
                    <div class="symbol" id="sym-x0">
                        <div class="sym-addr">X0</div>
                        <div class="sym-graphic">| |</div>
                        <div class="sym-name">å¯åŠ¨æ­£</div>
                    </div>
                    <div class="h-wire" id="wire-r1-2"></div>
                    <!-- X2 (Stop) -->
                    <div class="symbol" id="sym-x2-1">
                        <div class="sym-addr">X2</div>
                        <div class="sym-graphic">|/|</div>
                        <div class="sym-name">åœæ­¢</div>
                    </div>
                    <div class="h-wire" id="wire-r1-3"></div>
                    <!-- Y1 Interlock -->
                    <div class="symbol interlock-highlight" id="sym-y1-lock">
                        <div class="sym-addr">Y1</div>
                        <div class="sym-graphic">|/|</div>
                        <div class="sym-name">äº’é”</div>
                    </div>
                    <div class="h-wire" id="wire-r1-4"></div>
                    <!-- Y0 Coil -->
                    <div class="symbol" id="sym-y0">
                        <div class="sym-addr">Y0</div>
                        <div class="sym-graphic">( )</div>
                        <div class="sym-name">æ­£è½¬è¾“å‡º</div>
                    </div>
                    
                    <!-- å¹¶è”è‡ªé”çº¿ (Visual) -->
                    <div style="position:absolute; bottom:10px; left:40px; width:80px; height:15px; border-left:2px solid #333; border-bottom:2px solid #333; border-right:2px solid #333; z-index:0; display:flex; justify-content:center;">
                         <div style="background:#fff; margin-top:5px; font-size:10px;">Y0</div>
                    </div>
                </div>

                <!-- Rung 2: åè½¬ Y1 -->
                <div class="rung">
                    <div class="h-wire" id="wire-r2-1"></div>
                    <!-- X1 -->
                    <div class="symbol" id="sym-x1">
                        <div class="sym-addr">X1</div>
                        <div class="sym-graphic">| |</div>
                        <div class="sym-name">å¯åŠ¨å</div>
                    </div>
                    <div class="h-wire" id="wire-r2-2"></div>
                    <!-- X2 (Stop) -->
                    <div class="symbol" id="sym-x2-2">
                        <div class="sym-addr">X2</div>
                        <div class="sym-graphic">|/|</div>
                        <div class="sym-name">åœæ­¢</div>
                    </div>
                    <div class="h-wire" id="wire-r2-3"></div>
                    <!-- Y0 Interlock -->
                    <div class="symbol interlock-highlight" id="sym-y0-lock">
                        <div class="sym-addr">Y0</div>
                        <div class="sym-graphic">|/|</div>
                        <div class="sym-name">äº’é”</div>
                    </div>
                    <div class="h-wire" id="wire-r2-4"></div>
                    <!-- Y1 Coil -->
                    <div class="symbol" id="sym-y1">
                        <div class="sym-addr">Y1</div>
                        <div class="sym-graphic">( )</div>
                        <div class="sym-name">åè½¬è¾“å‡º</div>
                    </div>

                    <!-- å¹¶è”è‡ªé”çº¿ -->
                    <div style="position:absolute; bottom:10px; left:40px; width:80px; height:15px; border-left:2px solid #333; border-bottom:2px solid #333; border-right:2px solid #333; z-index:0; display:flex; justify-content:center;">
                        <div style="background:#fff; margin-top:5px; font-size:10px;">Y1</div>
                   </div>
                </div>
                
                <div style="padding:10px; font-size:12px; color:#666;">
                    * çº¢è‰²è™šçº¿æ¡†ä¸ºäº’é”è§¦ç‚¹ï¼šY0ç”µè·¯ä¸²è”Y1å¸¸é—­ï¼ŒY1ç”µè·¯ä¸²è”Y0å¸¸é—­ã€‚
                </div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨ï¼šæ–‡å­—å¼•å¯¼ä¸æ§åˆ¶ -->
    <div class="guide-container">
        <!-- åŠ¨æ€å¼•å¯¼æ–‡æœ¬ -->
        <div class="text-content" id="guide-text">
            <h3>æ“ä½œä¸åŸç†æ¼”ç¤º</h3>
            <p><strong>åˆå§‹çŠ¶æ€ï¼š</strong>ä¸€åˆ‡éƒ½æ˜¯ç°è‰²çš„ï¼Œç”µæœºåœæ­¢ã€‚</p>
            
            <p id="txt-fwd"><strong>æ­£è½¬æ“ä½œï¼š</strong><br>
            é•¿æŒ‰å·¦ä¾§çš„ <span class="step-highlight">X0 (æ­£è½¬)</span> æŒ‰é’®ã€‚<br>
            1. <strong>è¾“å…¥é‡‡æ ·ï¼š</strong>ä½ ä¼šçœ‹åˆ°PLCä¸Šçš„ 0 å·ç¯äº®èµ·ã€‚<br>
            2. <strong>ç¨‹åºæ‰§è¡Œï¼š</strong>æ¢¯å½¢å›¾ç¬¬ä¸€è¡Œå˜ç»¿ã€‚ç”µæµæµè¿‡ X0ï¼Œç»è¿‡ X2(é—­)ï¼Œå†ç»è¿‡ Y1(é—­-äº’é”ç‚¹)ï¼Œæœ€ç»ˆåˆ°è¾¾ Y0 çº¿åœˆã€‚<br>
            3. <strong>è¾“å‡ºåˆ·æ–°ï¼š</strong>å³ä¸‹è§’ç”µæœºå¼€å§‹é¡ºæ—¶é’ˆæ—‹è½¬ï¼ŒKM1 æ¥è§¦å™¨å˜çº¢ã€‚<br>
            æ¾å¼€é¼ æ ‡ï¼Œç”±äºæ¢¯å½¢å›¾é€»è¾‘ä¸­éšå«äº†â€œè‡ªé”â€ï¼ˆä»£ç é€»è¾‘ä¸­å¤„ç†äº† inputs.x0 || memory.y0ï¼‰ï¼Œç”µæœºç»§ç»­è½¬åŠ¨ã€‚</p>
            
            <p id="txt-lock"><strong>è§¦å‘äº’é”ï¼š</strong><br>
            åœ¨æ­£è½¬ï¼ˆY0é€šç”µï¼‰çš„æƒ…å†µä¸‹ï¼ŒæŒ‰ä¸‹ <span class="step-highlight">X1 (åè½¬)</span> æŒ‰é’®ã€‚<br>
            è§‚å¯Ÿæ¢¯å½¢å›¾ç¬¬äºŒè¡Œï¼šä½ ä¼šå‘ç°è™½ç„¶ X1 å¯¼é€šäº†ï¼Œä½†åœ¨çº¢æ¡†æ ‡è®°çš„ <strong>Y0äº’é”è§¦ç‚¹</strong> å¤„ï¼Œçº¿è·¯æ–­å¼€äº†ï¼ˆå› ä¸ºY0æ˜¯1ï¼ŒY0å¸¸é—­è§¦ç‚¹å°±æ˜¯0/æ–­å¼€ï¼‰ã€‚<br>
            <strong>ç»“æœï¼š</strong>Y1 çº¿åœˆæ— æ³•å¾—ç”µï¼Œç”µæœºä¸ä¼šåè½¬ï¼Œé˜²æ­¢äº†ç”µæºçŸ­è·¯ã€‚</p>
            
            <p id="txt-stop"><strong>åœæ­¢ï¼š</strong><br>
            æŒ‰ä¸‹ <span class="step-highlight">X2 (åœæ­¢)</span> æŒ‰é’®ã€‚<br>
            æ¢¯å½¢å›¾ä¸­çš„ X2 å¸¸é—­è§¦ç‚¹æ–­å¼€ï¼Œåˆ‡æ–­ç”µè·¯ï¼Œç”µæœºåœæ­¢ã€‚</p>
        </div>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="controls">
            <div>
                <label><strong>æ‰«æ/ä»¿çœŸé€Ÿåº¦:</strong></label>
                <input type="range" min="200" max="2000" value="800" oninput="updateSpeed(this.value)">
                <span id="speed-disp">800ms</span>
            </div>
            <div class="tip-box">
                <strong>Q: äº’é”ä¸€å®šæ˜¯æœ‰æ­£åè½¬çš„å—?</strong><br>
                A: <strong>ä¸ä¸€å®šã€‚</strong> äº’é”æ˜¯é˜²æ­¢ä¸¤ä¸ª"æ‰“æ¶"çš„åŠ¨ä½œåŒæ—¶å‘ç”Ÿã€‚æ¯”å¦‚ï¼š
                <ul>
                    <li>æ˜Ÿä¸‰è§’å¯åŠ¨ï¼ˆæ˜Ÿå‹æ¥è§¦å™¨å’Œè§’å‹æ¥è§¦å™¨äº’é”ï¼‰</li>
                    <li>å¿«è¿›ä¸å·¥è¿›ç”µç£é˜€</li>
                    <li>ä¸¤å°æ°´æ³µä¸èƒ½åŒæ—¶å¼€å¯çš„åœºæ™¯</li>
                </ul>
            </div>
        </div>
    </div>

<script>
    // --- æ ¸å¿ƒçŠ¶æ€ ---
    const plc = {
        in: { x0: 0, x1: 0, x2: 0 },
        mem: { y0: 0, y1: 0 },
        out: { y0: 0, y1: 0 },
        phase: 0 // 0:In, 1:Logic, 2:Out
    };
    
    let intervalTime = 800;
    let timer = null;

    // --- äº¤äº’æ§åˆ¶ ---
    function interact(btnId) {
        // 1. è®¾ç½®ç‰©ç†è¾“å…¥
        plc.in[btnId] = 1;
        
        // 2. è§†è§‰æ•ˆæœï¼šæŒ‰é’®æŒ‰ä¸‹
        const btn = document.getElementById('btn-' + btnId);
        btn.classList.add('pressed');
        
        // 3. è§†è§‰æ•ˆæœï¼šçº¿è·¯é«˜äº®
        document.getElementById('w-' + btnId).classList.add('hot');

        // 4. è§†è§‰æ•ˆæœï¼šæ‰‹æŒ‡åŠ¨ç”»
        showFinger(btn);

        // 5. æ–‡å­—æ»šåŠ¨æŒ‡å¼•
        highlightText(btnId);
    }

    function release(btnId) {
        plc.in[btnId] = 0;
        document.getElementById('btn-' + btnId).classList.remove('pressed');
        document.getElementById('w-' + btnId).classList.remove('hot');
    }

    function showFinger(targetBtn) {
        const finger = document.getElementById('virtual-finger');
        const rect = targetBtn.getBoundingClientRect();
        const containerRect = document.getElementById('phy-container').getBoundingClientRect();
        
        // è®¡ç®—ç›¸å¯¹ä½ç½®
        const left = rect.left - containerRect.left + 15;
        const top = rect.top - containerRect.top + 20;

        finger.style.left = left + 'px';
        finger.style.top = top + 'px';
        
        // é‡ç½®åŠ¨ç”»
        finger.classList.remove('tap');
        void finger.offsetWidth; // trigger reflow
        finger.classList.add('tap');
    }

    function highlightText(btnId) {
        const map = { 'x0': 'txt-fwd', 'x1': 'txt-lock', 'x2': 'txt-stop' };
        const elId = map[btnId];
        if(elId) {
            document.getElementById(elId).scrollIntoView({ behavior: 'smooth', block: 'center' });
            document.getElementById(elId).style.backgroundColor = "#fffbe6";
            setTimeout(() => document.getElementById(elId).style.backgroundColor = "transparent", 1000);
        }
    }

    function updateSpeed(val) {
        intervalTime = parseInt(val);
        document.getElementById('speed-disp').innerText = val + 'ms';
        clearInterval(timer);
        timer = setInterval(scanCycle, intervalTime);
    }

    // --- è§†è§‰æ›´æ–°è¾…åŠ©å‡½æ•° ---
    function setClass(id, cls, active) {
        const el = document.getElementById(id);
        if(el) active ? el.classList.add(cls) : el.classList.remove(cls);
    }

    function moveScanLine(top) {
        const line = document.getElementById('scan-line');
        if(top === null) {
            line.style.display = 'none';
        } else {
            line.style.display = 'block';
            line.style.top = top + 'px';
        }
    }

    // --- PLC æ‰«æå‘¨æœŸå¾ªç¯ ---
    function scanCycle() {
        // Step 1: è¾“å…¥é‡‡æ · (Input Refresh)
        if (plc.phase === 0) {
            moveScanLine(null); // éšè—æ‰«æçº¿
            // æ›´æ–°PLCé¢æ¿ä¸Šçš„LED
            setClass('led-x0', 'active', plc.in.x0);
            setClass('led-x1', 'active', plc.in.x1);
            setClass('led-x2', 'active', plc.in.x2);
            
            plc.phase = 1;
        }
        
        // Step 2: ç¨‹åºæ‰§è¡Œ (Logic Execution)
        else if (plc.phase === 1) {
            moveScanLine(50); // ç§»åŠ¨åˆ°ç¬¬ä¸€è¡Œ

            // --- RUNG 1: Y0 Logic ---
            // é€»è¾‘: (X0 OR Y0_SelfLock) AND (NOT X2) AND (NOT Y1_Interlock)
            const stopPressed = plc.in.x2 === 1; // ç‰©ç†æŒ‰ä¸‹äº†åœæ­¢
            const logicStop = !stopPressed; // æ¢¯å½¢å›¾X2æ˜¯å¸¸é—­ï¼Œç‰©ç†æ²¡æŒ‰å°±æ˜¯é€š(1)ï¼ŒæŒ‰äº†æ˜¯æ–­(0)
            
            const startFwd = plc.in.x0 || plc.mem.y0; // å¯åŠ¨æˆ–è‡ªé”
            const interlockY1 = !plc.mem.y1; // äº’é”ï¼šY1å¿…é¡»æ²¡ç”µï¼Œå¸¸é—­è§¦ç‚¹æ‰é€š
            
            // æ›´æ–°è§†å›¾çŠ¶æ€
            setClass('sym-x0', 'active-logic', plc.in.x0); // X0 é«˜äº®
            setClass('sym-x2-1', 'active-logic', logicStop); // X2 æ²¡æŒ‰æ—¶é«˜äº®
            setClass('sym-y1-lock', 'active-logic', interlockY1); // Y1 æ²¡ç”µæ—¶é«˜äº®
            
            // çº¿è·¯è¿é€šæ€§å¯è§†åŒ–
            setClass('wire-r1-1', 'active-logic', true); // æ¯çº¿
            setClass('wire-r1-2', 'active-logic', startFwd);
            setClass('wire-r1-3', 'active-logic', startFwd && logicStop);
            setClass('wire-r1-4', 'active-logic', startFwd && logicStop && interlockY1);
            
            // è®¡ç®—ç»“æœå†™å…¥å†…å­˜
            plc.mem.y0 = (startFwd && logicStop && interlockY1) ? 1 : 0;
            setClass('sym-y0', 'active-logic', plc.mem.y0);

            // åˆ‡æ¢åˆ°ä¸‹ä¸€è¡Œé€»è¾‘
            plc.phase = 2;
        }

        else if (plc.phase === 2) {
            moveScanLine(130); // ç§»åŠ¨åˆ°ç¬¬äºŒè¡Œ

            // --- RUNG 2: Y1 Logic ---
            const stopPressed = plc.in.x2 === 1;
            const logicStop = !stopPressed;

            const startRev = plc.in.x1 || plc.mem.y1; // å¯åŠ¨æˆ–è‡ªé”
            const interlockY0 = !plc.mem.y0; // äº’é”ï¼šY0å¿…é¡»æ²¡ç”µ
            
            setClass('sym-x1', 'active-logic', plc.in.x1);
            setClass('sym-x2-2', 'active-logic', logicStop);
            setClass('sym-y0-lock', 'active-logic', interlockY0);

            setClass('wire-r2-1', 'active-logic', true);
            setClass('wire-r2-2', 'active-logic', startRev);
            setClass('wire-r2-3', 'active-logic', startRev && logicStop);
            setClass('wire-r2-4', 'active-logic', startRev && logicStop && interlockY0);

            plc.mem.y1 = (startRev && logicStop && interlockY0) ? 1 : 0;
            setClass('sym-y1', 'active-logic', plc.mem.y1);

            plc.phase = 3;
        }
        
        // Step 3: è¾“å‡ºåˆ·æ–° (Output Refresh)
        else if (plc.phase === 3) {
            moveScanLine(null);
            
            // å†…å­˜ -> ç‰©ç†
            plc.out.y0 = plc.mem.y0;
            plc.out.y1 = plc.mem.y1;
            
            // æ›´æ–°è¾“å‡ºLED
            setClass('led-y0', 'active-out', plc.out.y0);
            setClass('led-y1', 'active-out', plc.out.y1);

            // æ›´æ–°æ¥è§¦å™¨å’Œè¿çº¿
            setClass('km1', 'active', plc.out.y0);
            setClass('w-y0', 'hot', plc.out.y0);
            
            setClass('km2', 'active', plc.out.y1);
            setClass('w-y1', 'hot', plc.out.y1);

            plc.phase = 0; // å›åˆ°å¼€å§‹
        }
    }

    // --- ç‹¬ç«‹å¾ªç¯æ§åˆ¶ç”µæœºåŠ¨ç”» ---
    function animateMotor() {
        const motor = document.getElementById('motor-shaft');
        const status = document.getElementById('motor-status');
        let rotation = 0;
        
        // è·å–å½“å‰transformè§’åº¦ä»¥ä¾¿å¹³æ»‘è¿‡æ¸¡
        const st = window.getComputedStyle(motor);
        const tr = st.getPropertyValue("transform");
        // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œç›´æ¥ç”¨å…¨å±€å˜é‡æˆ–æ—¶é—´æ§åˆ¶æ—‹è½¬
        
        const now = Date.now();
        
        if (plc.out.y0 === 1 && plc.out.y1 === 0) {
            motor.style.transform = `rotate(${now / 5}deg)`;
            status.innerText = "æ­£è½¬ FWD >>";
            status.style.color = "#2ecc71";
        } else if (plc.out.y0 === 0 && plc.out.y1 === 1) {
            motor.style.transform = `rotate(${-now / 5}deg)`;
            status.innerText = "<< åè½¬ REV";
            status.style.color = "#2ecc71";
        } else {
            status.innerText = "åœæ­¢ STOP";
            status.style.color = "#fff";
            // åœæ­¢æ—¶ä¿æŒå½“å‰è§’åº¦ä¸é‡ç½®çœ‹èµ·æ¥æ›´çœŸå®ï¼Œä½†HTMLç®€å•å®ç°å°±ä¸åšäº†
        }
        requestAnimationFrame(animateMotor);
    }

    // å¯åŠ¨
    timer = setInterval(scanCycle, intervalTime);
    animateMotor();

</script>
</body>
</html>